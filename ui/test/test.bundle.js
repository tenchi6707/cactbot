(()=>{"use strict";let e=!1,t=null,n=null,i=[],o=0;const l={},a={},r=(e,t)=>{n?i?i.push(e):n.send(JSON.stringify(e)):i?i.push([e,t]):window.OverlayPluginApi.callHandler(JSON.stringify(e),t)},s=e=>{b();const t=a[e.type];null==t||t.forEach((t=>t(e)))},d=s,c=(e,t)=>{var n;b(),a[e]||(a[e]=[],i||r({call:"subscribe",events:[e]})),null===(n=a[e])||void 0===n||n.push(t)},g=(e,t)=>{if(b(),a[e]){const n=a[e],i=null==n?void 0:n.indexOf(t);i&&i>-1&&(null==n||n.splice(i,1))}},$=e=>{b();const t={...e,rseq:0};let i;return n?(t.rseq=o++,i=new Promise((e=>{l[t.rseq]=e})),r(t)):i=new Promise((e=>{r(t,(t=>{e(null===t?null:JSON.parse(t))}))})),i};let u;const m=e=>(b(),u?u(e):$(e)),b=()=>{if(!e){if("undefined"!=typeof window){if(t=/[\?&]OVERLAY_WS=([^&]+)/.exec(window.location.href),t){const e=function(){n=new WebSocket(null==t?void 0:t[1]),n.addEventListener("error",(e=>{console.error(e)})),n.addEventListener("open",(()=>{console.log("Connected!");const e=null!=i?i:[];i=null,r({call:"subscribe",events:Object.keys(a)});for(const t of e)Array.isArray(t)||r(t)})),n.addEventListener("message",(e=>{var t;try{const n=JSON.parse(e.data);void 0!==n.rseq&&l[n.rseq]?(null===(t=l[n.rseq])||void 0===t||t.call(l,n),delete l[n.rseq]):s(n)}catch(t){return void console.error("Invalid message received: ",e)}})),n.addEventListener("close",(()=>{i=null,console.log("Trying to reconnect..."),setTimeout((()=>{e()}),300)}))};e()}else{const e=function(){if(!window.OverlayPluginApi||!window.OverlayPluginApi.ready)return void setTimeout(e,300);const t=null!=i?i:[];i=null,window.__OverlayCallback=s,r({call:"subscribe",events:Object.keys(a)});for(const e of t)Array.isArray(e)&&r(e[0],e[1])};e()}window.addOverlayListener=c,window.removeOverlayListener=g,window.callOverlayHandler=m,window.dispatchOverlayEvent=d}e=!0}};c("ChangeZone",(e=>{const t=document.getElementById("currentZone");t&&(t.innerText=`currentZone: ${e.zoneName} (${e.zoneID})`)})),c("onInCombatChangedEvent",(e=>{const t=document.getElementById("inCombat");t&&(t.innerText=`inCombat: act: ${e.detail.inACTCombat?"yes":"no"} game: ${e.detail.inGameCombat?"yes":"no"}`)})),c("onPlayerChangedEvent",(e=>{const t=document.getElementById("hp");t&&(t.innerText=`${e.detail.currentHP}/${e.detail.maxHP} (${e.detail.currentShield})`);const n=document.getElementById("mp");n&&(n.innerText=`${e.detail.currentMP}/${e.detail.maxMP}`);const i=document.getElementById("cp");i&&(i.innerText=`${e.detail.currentCP}/${e.detail.maxCP}`);const o=document.getElementById("gp");o&&(o.innerText=`${e.detail.currentGP}/${e.detail.maxGP}`);const l=document.getElementById("job");l&&(l.innerText=`${e.detail.level} ${e.detail.job}`);const a=document.getElementById("debug");a&&(a.innerText=e.detail.debugJob);const r=document.getElementById("jobinfo");if(r){const t=e.detail.jobDetail;"RDM"===e.detail.job?r.innerText=`${t.whiteMana} | ${t.blackMana}`:"WAR"===e.detail.job?r.innerText=t.beast.toString():"DRK"===e.detail.job?r.innerText=`${t.blood} | ${t.darksideMilliseconds} | ${t.darkArts.toString()} | ${t.livingShadowMilliseconds}`:"GNB"===e.detail.job?r.innerText=`${t.cartridges}${t.continuationState}`:"PLD"===e.detail.job?r.innerText=t.oath.toString():"BRD"===e.detail.job?r.innerText=`${t.songName} | ${t.songProcs} | ${t.soulGauge} | ${t.songMilliseconds}`:"DNC"===e.detail.job?r.innerText=`${t.feathers} | ${t.esprit} | (${t.steps}) | ${t.currentStep}`:"NIN"===e.detail.job?r.innerText=`${t.hutonMilliseconds} | ${t.ninkiAmount}`:"DRG"===e.detail.job?r.innerText=`${t.bloodMilliseconds} | ${t.lifeMilliseconds} | ${t.eyesAmount}`:"BLM"===e.detail.job?r.innerText=`${t.umbralStacks} (${t.umbralMilliseconds}) | ${t.umbralHearts} | ${t.foulCount} ${t.enochian.toString()} (${t.nextPolyglotMilliseconds})`:"THM"===e.detail.job?r.innerText=`${t.umbralStacks} (${t.umbralMilliseconds})`:"WHM"===e.detail.job?r.innerText=`${t.lilyStacks} (${t.lilyMilliseconds}) | ${t.bloodlilyStacks}`:"SMN"===e.detail.job?r.innerText=`${t.aetherflowStacks} | ${t.dreadwyrmStacks} | ${t.bahamutStance} | ${t.bahamutSummoned} (${t.stanceMilliseconds}) | ${t.phoenixReady}`:"SCH"===e.detail.job?r.innerText=`${t.aetherflowStacks} | ${t.fairyGauge} | ${t.fairyStatus} (${t.fairyMilliseconds})`:"ACN"===e.detail.job?r.innerText=t.aetherflowStacks.toString():"AST"===e.detail.job?r.innerText=`${t.heldCard} (${t.arcanums})`:"MNK"===e.detail.job?r.innerText=`${t.lightningStacks} (${t.lightningMilliseconds}) | ${t.chakraStacks} | ${t.lightningTimerFrozen.toString()}`:"PGL"===e.detail.job?r.innerText=`${t.lightningStacks} (${t.lightningMilliseconds})`:"MCH"===e.detail.job?r.innerText=`${t.heat} (${t.overheatMilliseconds}) | ${t.battery} (${t.batteryMilliseconds}) | last: ${t.lastBatteryAmount} | ${t.overheatActive.toString()} | ${t.robotActive.toString()}`:"SAM"===e.detail.job?r.innerText=`${t.kenki} | ${t.meditationStacks}(${t.setsu.toString()},${t.getsu.toString()},${t.ka.toString()})`:r.innerText=""}const s=document.getElementById("pos");s&&(s.innerText=`${e.detail.pos.x.toFixed(2)},${e.detail.pos.y.toFixed(2)},${e.detail.pos.z.toFixed(2)}`);const d=document.getElementById("rotation");d&&(d.innerText=e.detail.rotation.toString());const c=document.getElementById("bait");c&&(c.innerText=e.detail.bait.toString())})),c("EnmityTargetData",(e=>{const t=document.getElementById("target");t&&(t.innerText=e.Target?e.Target.Name:"--");const n=document.getElementById("tid");n&&(n.innerText=e.Target?e.Target.ID.toString(16):"");const i=document.getElementById("tdistance");i&&(i.innerText=e.Target?e.Target.Distance.toString():"")})),c("onGameExistsEvent",(e=>{})),c("onGameActiveChangedEvent",(e=>{})),c("onLogEvent",(e=>{e.detail.logs.forEach((e=>{const t=/00:0038:tts:(.*)/.exec(e);t&&t[1]&&m({call:"cactbotSay",text:t[1]})}))})),c("onUserFileChanged",(e=>{console.log(`User file ${e.file} changed!`)})),c("FileChanged",(e=>{console.log(`File ${e.file} changed!`)})),m({call:"cactbotRequestState"})})();